%brincando com o dado iris
%visualizando com o isomap 
%
clear all, close all

iris = [5.1,3.5,1.4,0.2,1
4.9,3.0,1.4,0.2,1
4.7,3.2,1.3,0.2,1
4.6,3.1,1.5,0.2,1
5.0,3.6,1.4,0.2,1
5.4,3.9,1.7,0.4,1
4.6,3.4,1.4,0.3,1
5.0,3.4,1.5,0.2,1
4.4,2.9,1.4,0.2,1
4.9,3.1,1.5,0.1,1
5.4,3.7,1.5,0.2,1
4.8,3.4,1.6,0.2,1
4.8,3.0,1.4,0.1,1
4.3,3.0,1.1,0.1,1
5.8,4.0,1.2,0.2,1
5.7,4.4,1.5,0.4,1
5.4,3.9,1.3,0.4,1
5.1,3.5,1.4,0.3,1
5.7,3.8,1.7,0.3,1
5.1,3.8,1.5,0.3,1
5.4,3.4,1.7,0.2,1
5.1,3.7,1.5,0.4,1
4.6,3.6,1.0,0.2,1
5.1,3.3,1.7,0.5,1
4.8,3.4,1.9,0.2,1
5.0,3.0,1.6,0.2,1
5.0,3.4,1.6,0.4,1
5.2,3.5,1.5,0.2,1
5.2,3.4,1.4,0.2,1
4.7,3.2,1.6,0.2,1
4.8,3.1,1.6,0.2,1
5.4,3.4,1.5,0.4,1
5.2,4.1,1.5,0.1,1
5.5,4.2,1.4,0.2,1
4.9,3.1,1.5,0.1,1
5.0,3.2,1.2,0.2,1
5.5,3.5,1.3,0.2,1
4.9,3.1,1.5,0.1,1
4.4,3.0,1.3,0.2,1
5.1,3.4,1.5,0.2,1
5.0,3.5,1.3,0.3,1
4.5,2.3,1.3,0.3,1
4.4,3.2,1.3,0.2,1
5.0,3.5,1.6,0.6,1
5.1,3.8,1.9,0.4,1
4.8,3.0,1.4,0.3,1
5.1,3.8,1.6,0.2,1
4.6,3.2,1.4,0.2,1
5.3,3.7,1.5,0.2,1
5.0,3.3,1.4,0.2,1
7.0,3.2,4.7,1.4,2
6.4,3.2,4.5,1.5,2
6.9,3.1,4.9,1.5,2
5.5,2.3,4.0,1.3,2
6.5,2.8,4.6,1.5,2
5.7,2.8,4.5,1.3,2
6.3,3.3,4.7,1.6,2
4.9,2.4,3.3,1.0,2
6.6,2.9,4.6,1.3,2
5.2,2.7,3.9,1.4,2
5.0,2.0,3.5,1.0,2
5.9,3.0,4.2,1.5,2
6.0,2.2,4.0,1.0,2
6.1,2.9,4.7,1.4,2
5.6,2.9,3.6,1.3,2
6.7,3.1,4.4,1.4,2
5.6,3.0,4.5,1.5,2
5.8,2.7,4.1,1.0,2
6.2,2.2,4.5,1.5,2
5.6,2.5,3.9,1.1,2
5.9,3.2,4.8,1.8,2
6.1,2.8,4.0,1.3,2
6.3,2.5,4.9,1.5,2
6.1,2.8,4.7,1.2,2
6.4,2.9,4.3,1.3,2
6.6,3.0,4.4,1.4,2
6.8,2.8,4.8,1.4,2
6.7,3.0,5.0,1.7,2
6.0,2.9,4.5,1.5,2
5.7,2.6,3.5,1.0,2
5.5,2.4,3.8,1.1,2
5.5,2.4,3.7,1.0,2
5.8,2.7,3.9,1.2,2
6.0,2.7,5.1,1.6,2
5.4,3.0,4.5,1.5,2
6.0,3.4,4.5,1.6,2
6.7,3.1,4.7,1.5,2
6.3,2.3,4.4,1.3,2
5.6,3.0,4.1,1.3,2
5.5,2.5,4.0,1.3,2
5.5,2.6,4.4,1.2,2
6.1,3.0,4.6,1.4,2
5.8,2.6,4.0,1.2,2
5.0,2.3,3.3,1.0,2
5.6,2.7,4.2,1.3,2
5.7,3.0,4.2,1.2,2
5.7,2.9,4.2,1.3,2
6.2,2.9,4.3,1.3,2
5.1,2.5,3.0,1.1,2
5.7,2.8,4.1,1.3,2
6.3,3.3,6.0,2.5,3
5.8,2.7,5.1,1.9,3
7.1,3.0,5.9,2.1,3
6.3,2.9,5.6,1.8,3
6.5,3.0,5.8,2.2,3
7.6,3.0,6.6,2.1,3
4.9,2.5,4.5,1.7,3
7.3,2.9,6.3,1.8,3
6.7,2.5,5.8,1.8,3
7.2,3.6,6.1,2.5,3
6.5,3.2,5.1,2.0,3
6.4,2.7,5.3,1.9,3
6.8,3.0,5.5,2.1,3
5.7,2.5,5.0,2.0,3
5.8,2.8,5.1,2.4,3
6.4,3.2,5.3,2.3,3
6.5,3.0,5.5,1.8,3
7.7,3.8,6.7,2.2,3
7.7,2.6,6.9,2.3,3
6.0,2.2,5.0,1.5,3
6.9,3.2,5.7,2.3,3
5.6,2.8,4.9,2.0,3
7.7,2.8,6.7,2.0,3
6.3,2.7,4.9,1.8,3
6.7,3.3,5.7,2.1,3
7.2,3.2,6.0,1.8,3
6.2,2.8,4.8,1.8,3
6.1,3.0,4.9,1.8,3
6.4,2.8,5.6,2.1,3
7.2,3.0,5.8,1.6,3
7.4,2.8,6.1,1.9,3
7.9,3.8,6.4,2.0,3
6.4,2.8,5.6,2.2,3
6.3,2.8,5.1,1.5,3
6.1,2.6,5.6,1.4,3
7.7,3.0,6.1,2.3,3
6.3,3.4,5.6,2.4,3
6.4,3.1,5.5,1.8,3
6.0,3.0,4.8,1.8,3
6.9,3.1,5.4,2.1,3
6.7,3.1,5.6,2.4,3
6.9,3.1,5.1,2.3,3
5.8,2.7,5.1,1.9,3
6.8,3.2,5.9,2.3,3
6.7,3.3,5.7,2.5,3
6.7,3.0,5.2,2.3,3
6.3,2.5,5.0,1.9,3
6.5,3.0,5.2,2.0,3
6.2,3.4,5.4,2.3,3
5.9,3.0,5.1,1.8,3];
y =  iris(:,5);
x1 = iris(:,1);
x2 = iris(:,2);
x3 = iris(:,3);
x4 = iris(:,4);
X = [x1 x2 x3 x4];

% matriz de distancias euclidianas
D = euclid_dist_linalg(X,2);
n = size(D,1);
%Escolhendo os k vizinhos
K = 70;
%Organiza D 
G = zeros(size(D));
for i =1:n
   xaux = D(i,:);
   [~, I] = sort(xaux);
   for k = 2:K+1
       G(i,I(k)) = xaux(I(k));
   end
end
D_g = zeros(size(G));
D_g(G==0) = Inf;
D_g = G + D_g;
%Algoritmo de Floyd
for i=1:n
    Aux = repmat(D_g(:,i), 1, n)+repmat(D_g(i,:), n, 1);
    D_g = min(D_g,Aux); 
end

D_g(D_g==Inf) = 0;
D_g = (D_g + D_g')/2;
%aplicando o mds classico no isomap
M = eye(size(D_g)).*(diag(diag(D_g)));
D_g2 = D_g - M;
A = (-1/2)*D_g2.^2;  
H2 = eye(n) - (1/n)*(ones(n,n));
B2 = (H2*A*H2);
n_auto_val = 3;
[auto_vet, auto_val] = eigs(B2, n_auto_val, 'LR');
% [aut_val_desc, ind_aut_val] = sort(auto_val, 'descend');
s = struct();
s2 = struct();
euc_Y = struct();
for i=1:n_auto_val
    a_vet = auto_vet(1:end,1:i);
    a_val = auto_val(1:i,1:i);
%     a_vet = auto_vet(1:end,end:end-i+1);
%     a_val = auto_val(end:end-i+1,end:end-i+1);
    s(i).Y = a_vet*sqrt(a_val);
    euc_Y(i).Y = euclid_dist_linalg(s(i).Y,2);
    %Correlação entre a matriz de Distancias geodesicas, e 
    %a matriz de Distancias dos pontos reconstruidos
    J2(i) = 1 - corr2(euc_Y(i).Y, D_g2)^2;%Variância Residual
end

subplot(211)
grid on
hold on
plot(s(2).Y(1:50,1), s(2).Y(1:50,2),'b.')
plot(s(2).Y(50:100,1), s(2).Y(50:100,2),'r.')
plot(s(2).Y(100:150,1), s(2).Y(100:150,2),'k.')
legend('Setosa','Versicolor','Virginica' )



subplot(212)
grid on
hold on
plot3(s(3).Y(1:50,1), s(3).Y(1:50,2), s(3).Y(1:50,3), 'b.')
plot3(s(3).Y(50:100,1), s(3).Y(50:100,2), s(3).Y(50:100,3), 'r.')
plot3(s(3).Y(100:150,1), s(3).Y(100:150,2), s(3).Y(100:150,3), 'k.')
legend('Setosa', 'Versicolor','Virginica')



